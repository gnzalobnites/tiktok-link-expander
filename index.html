<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="application-name" content="CleanTik Link Cleaner">
    <meta name="apple-mobile-web-app-title" content="CleanTik">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="CleanTik Link Cleaner">
    <meta property="og:description" content="Limpia enlaces de TikTok eliminando par√°metros de tracking y expandiendo enlaces cortos (vm.tiktok.com).">
    <meta property="og:image" content="https://gnzalobnites.github.io/tiktok-link-expander/clean-tik-og.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gnzalobnites.github.io/tiktok-link-expander/">
    <meta property="og:locale" content="es_ES">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" href="favicon.ico">
    
    <title>CleanTik Link Cleaner</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="contenedor-principal">
        <div class="titulo">
            Limpiador de Enlaces de TikTok
        </div>

        <div class="instrucciones">
            <h3>üõ†Ô∏è C√≥mo usarla:</h3>
            <ol>
                <li>Abre la app.</li>
                <li>Pega el enlace de TikTok (corto o largo).</li>
                <li>Haz clic en "Limpiar Enlace".</li>
                <li>Copia la URL limpia y √∫sala donde quieras.</li>
            </ol>
        </div>
        
        <div class="input-container">
            <input type="url" id="urlInput" placeholder="Pega aqu√≠ el enlace de TikTok" />
            <button class="boton-central" onclick="limpiarEnlace()">
                Limpiar Enlace
            </button>
        </div>
        
        <div class="mensaje-error" id="mensajeError"></div>
        
        <div class="resultado-container" id="resultadoContainer">
            <input type="text" id="urlResultado" readonly />
            <div class="botones-resultado">
                <button class="copiar-btn" onclick="copiarEnlace()">
                    Copiar enlace limpio
                </button>
                <button class="borrar-btn" onclick="borrarResultado()">
                    Borrar
                </button>
            </div>
        </div>

        <!-- Contenedor para el bot√≥n de instalaci√≥n -->
        <div class="footer-instalar" id="footerInstalarContainer"></div>
    </div>

    <footer>
        ¬øTienes sugerencias? Escr√≠beme a 
        <a href="mailto:benitesgonzalogaston@gmail.com">benitesgonzalogaston@gmail.com</a><br>
        ¬øTe sirve esta herramienta? 
        <a href="https://www.buymeacoffee.com/gnzbenitesh" target="_blank" rel="noopener">
            ‚òï Inv√≠tame un caf√©
        </a>
    </footer>

    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registrado correctamente:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Error al registrar Service Worker:', error);
                    });
            });
        }
        
        // Mostrar banner de instalaci√≥n en Android/Chrome
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevenir que Chrome muestre autom√°ticamente el banner
            e.preventDefault();
            // Guardar el evento para mostrarlo m√°s tarde
            deferredPrompt = e;
            
            // Mostrar el bot√≥n personalizado para instalar
            mostrarBotonInstalacion();
        });
        
        function mostrarBotonInstalacion() {
            // Solo mostrar si no est√° ya instalado
            if (window.matchMedia('(display-mode: standalone)').matches || 
                (window.navigator.standalone !== undefined && window.navigator.standalone)) {
                return;
            }
            
            // Crear bot√≥n de instalaci√≥n en el footer si no existe
            if (!document.getElementById('instalarBtn') && deferredPrompt) {
                const footerContainer = document.getElementById('footerInstalarContainer');
                if (footerContainer) {
                    const instalarBtn = document.createElement('button');
                    instalarBtn.id = 'instalarBtn';
                    instalarBtn.className = 'footer-instalar-btn';
                    instalarBtn.innerHTML = 'üì≤ Instalar como App';
                    instalarBtn.onclick = instalarApp;
                    footerContainer.appendChild(instalarBtn);
                    
                    // A√±adir animaci√≥n de entrada
                    setTimeout(() => {
                        instalarBtn.style.opacity = '1';
                        instalarBtn.style.transform = 'translateY(0)';
                    }, 100);
                }
            }
        }
        
        function instalarApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('Usuario instal√≥ la PWA');
                        // Cambiar texto del bot√≥n
                        const btn = document.getElementById('instalarBtn');
                        if (btn) {
                            btn.innerHTML = '‚úÖ ¬°Instalada!';
                            btn.style.background = '#2e7d32';
                            btn.style.cursor = 'default';
                            btn.onclick = null;
                            setTimeout(() => {
                                btn.style.display = 'none';
                            }, 2000);
                        }
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // Verificar si ya est√° instalado al cargar
        window.addEventListener('load', () => {
            // Detectar si ya est√° instalado como PWA
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isIOSStandalone = window.navigator.standalone === true;
            
            if (isStandalone || isIOSStandalone) {
                console.log('App ya instalada como PWA');
                const btn = document.getElementById('instalarBtn');
                if (btn) btn.style.display = 'none';
            } else {
                // Mostrar bot√≥n de instalaci√≥n despu√©s de 2 segundos
                setTimeout(mostrarBotonInstalacion, 2000);
            }
        });
        
        // Evento cuando se instala
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA instalado correctamente');
            const btn = document.getElementById('instalarBtn');
            if (btn) {
                btn.innerHTML = '‚úÖ ¬°Instalada!';
                btn.style.background = '#2e7d32';
                btn.style.cursor = 'default';
                btn.onclick = null;
                setTimeout(() => {
                    btn.style.display = 'none';
                }, 2000);
            }
        });
    </script>

    <script src="js/script.js"></script>
</body>
</html>
